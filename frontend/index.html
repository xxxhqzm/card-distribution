<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Card Distribution</title>
    </head>
    <body>
        <div class="container">
            <h1>Card Distribution</h1>
            <label for="numPeople">Enter number of people (1-52):</label>
            <input type="number" id="numPeople" min="1" max="52">
            <button id="fetchButton">Distribute Cards</button>
            <div id="error" class="error"></div>

            <div id="result"></div>
            <div id="result-raw"></div>
        </div>


        <script>
            async function fetchCardDistribution(numPeople) {
                const errorElement = document.getElementById('error');

                errorElement.innerHTML = '';

                try {
                    const response = await fetch(`http://localhost:8080/?num_people=${numPeople}`);
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    const data = await response.json();
                    if (data.status === "success") {
                        console.log("Cards distributed successfully:", data.data);
                        displayCards(data.data);
                    } else {
                        console.error("Error from backend:", data.message);
                        errorElement.innerHTML =`Error: ${data.message}`;
                    }
                } catch (error) {
                    console.error("Error fetching data:", error);
                    errorElement.innerHTML ="An error occurred while fetching data. Please try again.";
                }
            }

            function displayCards(datareceived) {
                const resultsDiv = document.getElementById("result");
                const resultRawDiv = document.getElementById("result-raw");
                const errorElement = document.getElementById('error');

                resultsDiv.innerHTML = "<h2>Result</h2>";
                errorElement.innerHTML = '';

                resultRawDiv.innerHTML = `<h2>RAW Result</h2><br><pre>${JSON.stringify(datareceived, null, 2)}</pre>`;
                const rows = datareceived.map(row => row.split(','))
                rows.forEach((row, index) => {
                    const personRow = document.createElement("div");
                    personRow.textContent = `Person ${index + 1}: ${row}`;
                    resultsDiv.appendChild(personRow);
                });
            }

            document.getElementById("fetchButton").addEventListener("click", () => {
                const numPeople = document.getElementById("numPeople").value;
                if (!numPeople || numPeople <= 0) {
                     errorElement.innerHTML ="Please enter a valid number of people.";
                    return;
                }
                fetchCardDistribution(numPeople);
            });
        </script>
    </body>
</html>